{% comment %}
  Kefey Testimonials Grid
  - Static grid of testimonial cards with heading highlight
  - Accessible stars, customizable colors, and spacing
{% endcomment %}

<section class="kefey-testimonials-grid color-{{ section.settings.color_scheme }}" style="--ktg-card-bg: {{ section.settings.card_bg_color }}; --ktg-card-radius: {{ section.settings.card_radius }}px; --ktg-star-color: {{ section.settings.star_color }}; --ktg-quote-color: {{ section.settings.quote_color }};">
  <div class="kefey-testimonials-grid__inner page-width">
    {% if section.settings.heading != blank %}
      <div class="kefey-testimonials-grid__header">
        <h2 class="kefey-testimonials-grid__title">
          <span class="kefey-testimonials-grid__title-text">{{ section.settings.heading }}</span>
          <span class="kefey-testimonials-grid__highlight" style="background-color: {{ section.settings.highlight_color }};"></span>
        </h2>
      </div>
    {% endif %}

    <div class="kefey-testimonials-grid__grid kefey-testimonials-grid__grid--cols-{{ section.settings.columns_desktop }}">
      {% for block in section.blocks %}
        {% assign rating = block.settings.rating | at_least: 0 | at_most: 5 %}
        <article class="kefey-testimonials-grid__card" {{ block.shopify_attributes }}>
          <div class="kefey-testimonials-grid__quotes" aria-hidden="true">“”</div>
          <div class="kefey-testimonials-grid__stars" role="img" aria-label="{{ rating }} out of 5 stars">
            {% for i in (1..rating) %}
              <svg class="kefey-testimonials-grid__star" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
              </svg>
            {% endfor %}
            {% for i in (rating..4) %}
              {% if forloop.first == false %}
                <svg class="kefey-testimonials-grid__star kefey-testimonials-grid__star--empty" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                  <path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                </svg>
              {% endif %}
            {% endfor %}
          </div>
          <div class="kefey-testimonials-grid__content rte">{{ block.settings.review_text }}</div>
          {% if block.settings.customer_name != blank %}
            <div class="kefey-testimonials-grid__name">{{ block.settings.customer_name }}</div>
          {% endif %}
        </article>
      {% endfor %}
    </div>
  </div>

  {% if section.settings.show_decorations %}
    <div class="kefey-testimonials-grid__decor kefey-testimonials-grid__decor--left" aria-hidden="true"></div>
    <div class="kefey-testimonials-grid__decor kefey-testimonials-grid__decor--right" aria-hidden="true"></div>
  {% endif %}
</section>

{% style %}
.kefey-testimonials-grid {
  padding-top: {{ section.settings.padding_top }}px;
  padding-bottom: {{ section.settings.padding_bottom }}px;
  position: relative;
}
.kefey-testimonials-grid__header {
  text-align: center;
  margin-bottom: 2.8rem;
}
.kefey-testimonials-grid__title {
  position: relative;
  display: inline-block;
  font-family: var(--font-heading-family);
  font-weight: 800;
  font-size: {{ section.settings.heading_size }}px;
  line-height: 1.1;
  margin: 0;
}
.kefey-testimonials-grid__title-text {
  position: relative;
  z-index: 1;
}
.kefey-testimonials-grid__highlight {
  position: absolute;
  left: 0;
  right: 0;
  height: 12px;
  bottom: -6px;
  z-index: 0;
}
.kefey-testimonials-grid__grid {
  display: grid;
  gap: 2.4rem;
}
.kefey-testimonials-grid__grid--cols-3 {
  grid-template-columns: 1fr;
}
@media screen and (min-width: 750px) {
  .kefey-testimonials-grid__grid--cols-3 {
    grid-template-columns: repeat(3, 1fr);
  }
}
.kefey-testimonials-grid__card {
  background: var(--ktg-card-bg, #FFE082);
  border-radius: var(--ktg-card-radius, 24px);
  padding: 2.4rem;
  text-align: center;
  min-height: 28rem;
  box-shadow: 0 2px 0 rgba(0,0,0,0.05);
}
.kefey-testimonials-grid__quotes {
  font-size: 4.2rem;
  line-height: 1;
  color: var(--ktg-quote-color, #2bb4a7);
  font-weight: 800;
  margin-bottom: 0.8rem;
}
.kefey-testimonials-grid__stars {
  color: var(--ktg-star-color, #e15241);
  display: inline-flex;
  gap: 0.3rem;
  margin-bottom: 1.2rem;
}
.kefey-testimonials-grid__star--empty {
  opacity: 0.25;
}
.kefey-testimonials-grid__content {
  color: rgba(var(--color-foreground), 0.9);
  font-size: 1.4rem;
}
.kefey-testimonials-grid__name {
  margin-top: 1.6rem;
  font-weight: 700;
}
.kefey-testimonials-grid__decor {
  position: absolute;
  width: 120px;
  height: 120px;
  background: radial-gradient(circle at 30% 30%, rgba(255, 199, 44, 0.35), transparent 60%);
  pointer-events: none;
}
.kefey-testimonials-grid__decor--left {
  top: 10%;
  left: 2%;
}
.kefey-testimonials-grid__decor--right {
  bottom: 12%;
  right: 4%;
}
{% endstyle %}

{% schema %}
{
  "name": "Kefey Testimonials Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Joyful Routines. That’s Why They Stay!" },
    { "type": "range", "id": "heading_size", "label": "Heading size", "min": 20, "max": 64, "step": 1, "default": 36 },
    { "type": "color", "id": "highlight_color", "label": "Highlight color", "default": "#FFC94D" },
    { "type": "color", "id": "card_bg_color", "label": "Card background", "default": "#FFE082" },
    { "type": "range", "id": "card_radius", "label": "Card corner radius", "min": 0, "max": 48, "step": 1, "default": 24 },
    { "type": "color", "id": "star_color", "label": "Star color", "default": "#E15241" },
    { "type": "color", "id": "quote_color", "label": "Quote color", "default": "#2BB4A7" },
    { "type": "checkbox", "id": "show_decorations", "label": "Show decorative shapes", "default": true },
    { "type": "range", "id": "columns_desktop", "label": "Columns (desktop)", "min": 2, "max": 4, "step": 1, "default": 3 },
    { "type": "select", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1", "options": [
      { "value": "scheme-1", "label": "Scheme 1" },
      { "value": "scheme-2", "label": "Scheme 2" },
      { "value": "scheme-3", "label": "Scheme 3" },
      { "value": "scheme-4", "label": "Scheme 4" }
    ]},
    { "type": "range", "id": "padding_top", "label": "Padding top", "min": 0, "max": 80, "step": 4, "default": 40 },
    { "type": "range", "id": "padding_bottom", "label": "Padding bottom", "min": 0, "max": 80, "step": 4, "default": 40 }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "range", "id": "rating", "label": "Rating", "min": 1, "max": 5, "step": 1, "default": 5 },
        { "type": "richtext", "id": "review_text", "label": "Review text", "default": "<p>After a week, my days felt more even. No spikes, no crashes, just steadier energy and mood.</p>" },
        { "type": "text", "id": "customer_name", "label": "Customer name", "default": "Maya" }
      ]
    }
  ],
  "max_blocks": 8,
  "presets": [
    {
      "name": "Kefey Testimonials Grid",
      "category": "Testimonials",
      "blocks": [
        { "type": "testimonial" },
        { "type": "testimonial" },
        { "type": "testimonial" }
      ]
    }
  ]
}
{% endschema %}

