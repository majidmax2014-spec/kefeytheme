{% comment %}
  Kefey Testimonials Carousel
  - Carousel of testimonial cards with heading highlight
  - Accessible stars, customizable colors, and spacing
{% endcomment %}

{{ 'kefey-testimonials-grid.css' | asset_url | stylesheet_tag }}

<section
  id="TestimonialsCarousel-{{ section.id }}"
  class="kefey-testimonials-grid color-{{ section.settings.color_scheme }}"
  style="--ktg-card-bg: {{ section.settings.card_bg_color }}; --ktg-card-radius: {{ section.settings.card_radius }}px; --ktg-star-color: {{ section.settings.star_color }}; --ktg-quote-color: {{ section.settings.quote_color }}; --ktg-gap: 2.4rem; --ktg-quote-icon-size: {{ section.settings.quote_icon_size | default: 72 }}px; --ktg-quote-icon-mt: {{ section.settings.quote_icon_margin_top | default: 0 }}px; --ktg-quote-icon-mb: {{ section.settings.quote_icon_margin_bottom | default: 12 }}px; --ktg-decor-left-w: {{ section.settings.left_decor_width | default: 160 }}px; --ktg-decor-left-x: {{ section.settings.left_decor_offset_x | default: 0 }}px; --ktg-decor-left-y: {{ section.settings.left_decor_offset_y | default: 0 }}px; --ktg-decor-right-w: {{ section.settings.right_decor_width | default: 160 }}px; --ktg-decor-right-x: {{ section.settings.right_decor_offset_x | default: 0 }}px; --ktg-decor-right-y: {{ section.settings.right_decor_offset_y | default: 0 }}px;"
  data-autoplay="{{ section.settings.autoplay }}"
  data-speed="{{ section.settings.autoplay_speed | default: 5000 }}"
>
  <div class="kefey-testimonials-grid__inner page-width">
    {% if section.settings.heading != blank %}
      <div class="kefey-testimonials-grid__header">
        <h2 class="kefey-testimonials-grid__title">
          <span class="kefey-testimonials-grid__title-text">{{ section.settings.heading }}</span>
          <span class="kefey-testimonials-grid__highlight" style="background-color: {{ section.settings.highlight_color }};"></span>
        </h2>
      </div>
    {% endif %}

    <div class="kefey-testimonials-grid__carousel-wrapper">
      <div class="kefey-testimonials-grid__viewport" aria-roledescription="carousel">
        <ul class="kefey-testimonials-grid__track" role="list" tabindex="0" aria-label="Testimonials carousel">
          {% for block in section.blocks %}
            {% assign rating = block.settings.rating | at_least: 0 | at_most: 5 %}
            <li class="kefey-testimonials-grid__slide" {{ block.shopify_attributes }}>
              <article class="kefey-testimonials-grid__card">
                <div class="kefey-testimonials-grid__quotes{% if section.settings.quote_icon != blank %} kefey-testimonials-grid__quotes--has-icon{% endif %}" aria-hidden="true">
                  {% if section.settings.quote_icon != blank %}
                    {{ section.settings.quote_icon | image_url: width: 120 | image_tag: class: 'kefey-testimonials-grid__quote-icon', alt: '', loading: 'lazy' }}
                  {% endif %}
                </div>
                <div class="kefey-testimonials-grid__stars" role="img" aria-label="{{ rating }} out of 5 stars">
                  {% for i in (1..rating) %}
                    <svg class="kefey-testimonials-grid__star" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                  {% endfor %}
                  {% for i in (rating..4) %}
                    {% if forloop.first == false %}
                      <svg class="kefey-testimonials-grid__star kefey-testimonials-grid__star--empty" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                        <path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                      </svg>
                    {% endif %}
                  {% endfor %}
                </div>
                <div class="kefey-testimonials-grid__content rte">{{ block.settings.review_text }}</div>
                {% if block.settings.customer_name != blank %}
                  <div class="kefey-testimonials-grid__name">{{ block.settings.customer_name }}</div>
                {% endif %}
              </article>
            </li>
          {% endfor %}
        </ul>
      </div>

      <button class="kefey-testimonials-grid__arrow kefey-testimonials-grid__arrow--prev" type="button" aria-label="Previous testimonials" tabindex="0">
        <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
      </button>
      <button class="kefey-testimonials-grid__arrow kefey-testimonials-grid__arrow--next" type="button" aria-label="Next testimonials" tabindex="0">
        <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
      </button>

      <div class="kefey-testimonials-grid__dots" role="tablist" aria-label="Testimonials pagination"></div>
    </div>
  </div>

  {% if section.settings.show_decor_images %}
    {% if section.settings.left_decor_image != blank %}
      <div class="kefey-testimonials-grid__decor-img kefey-testimonials-grid__decor-img--left" aria-hidden="true">
        {{ section.settings.left_decor_image | image_url: width: 800 | image_tag: loading: 'lazy', alt: '' }}
      </div>
    {% endif %}
    {% if section.settings.right_decor_image != blank %}
      <div class="kefey-testimonials-grid__decor-img kefey-testimonials-grid__decor-img--right" aria-hidden="true">
        {{ section.settings.right_decor_image | image_url: width: 800 | image_tag: loading: 'lazy', alt: '' }}
      </div>
    {% endif %}
  {% endif %}

  {% if section.settings.show_decorations %}
    <div class="kefey-testimonials-grid__decor kefey-testimonials-grid__decor--left" aria-hidden="true"></div>
    <div class="kefey-testimonials-grid__decor kefey-testimonials-grid__decor--right" aria-hidden="true"></div>
  {% endif %}
</section>

{{ 'kefey-testimonials-grid.js' | asset_url | script_tag }}

{% style %}
.kefey-testimonials-grid {
  padding-top: {{ section.settings.padding_top }}px;
  padding-bottom: {{ section.settings.padding_bottom }}px;
  position: relative;
}
.kefey-testimonials-grid__header {
  text-align: center;
  margin-bottom: 2.8rem;
}
.kefey-testimonials-grid__title {
  position: relative;
  display: inline-block;
  font-family: var(--font-heading-family);
  font-weight: 800;
  font-size: {{ section.settings.heading_size }}px;
  line-height: 1.1;
  margin: 0;
}
.kefey-testimonials-grid__title-text {
  position: relative;
  z-index: 1;
}
.kefey-testimonials-grid__highlight {
  position: absolute;
  left: 0;
  right: 0;
  height: 12px;
  bottom: -6px;
  z-index: 0;
}
{% endstyle %}

{% schema %}
{
  "name": "Testimonials Carousel",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Joyful Routines. Thatâ€™s Why They Stay!" },
    { "type": "range", "id": "heading_size", "label": "Heading size", "min": 20, "max": 64, "step": 1, "default": 36 },
    { "type": "color", "id": "highlight_color", "label": "Highlight color", "default": "#FFC94D" },
    { "type": "color", "id": "card_bg_color", "label": "Card background", "default": "#FFE082" },
    { "type": "range", "id": "card_radius", "label": "Card corner radius", "min": 0, "max": 48, "step": 1, "default": 24 },
    { "type": "color", "id": "star_color", "label": "Star color", "default": "#E15241" },
    { "type": "color", "id": "quote_color", "label": "Quote color", "default": "#2BB4A7" },
    { "type": "image_picker", "id": "quote_icon", "label": "Quote icon (SVG/PNG)" },
    { "type": "range", "id": "quote_icon_size", "label": "Quote icon size (px)", "min": 16, "max": 140, "step": 2, "default": 72 },
    { "type": "range", "id": "quote_icon_margin_top", "label": "Quote icon margin top (px)", "min": -80, "max": 60, "step": 2, "default": 0 },
    { "type": "range", "id": "quote_icon_margin_bottom", "label": "Quote icon margin bottom (px)", "min": -40, "max": 80, "step": 2, "default": 12 },
    { "type": "checkbox", "id": "show_decor_images", "label": "Show decor images", "default": true },
    { "type": "image_picker", "id": "left_decor_image", "label": "Left decor image" },
    { "type": "range", "id": "left_decor_width", "label": "Left decor width (px)", "min": 40, "max": 600, "step": 7, "default": 160 },
    { "type": "range", "id": "left_decor_offset_x", "label": "Left decor offset X (px)", "min": -300, "max": 300, "step": 6, "default": 0 },
    { "type": "range", "id": "left_decor_offset_y", "label": "Left decor offset Y (px)", "min": -200, "max": 200, "step": 4, "default": 0 },
    { "type": "image_picker", "id": "right_decor_image", "label": "Right decor image" },
    { "type": "range", "id": "right_decor_width", "label": "Right decor width (px)", "min": 40, "max": 600, "step": 7, "default": 160 },
    { "type": "range", "id": "right_decor_offset_x", "label": "Right decor offset X (px)", "min": -300, "max": 300, "step": 6, "default": 0 },
    { "type": "range", "id": "right_decor_offset_y", "label": "Right decor offset Y (px)", "min": -200, "max": 200, "step": 4, "default": 0 },
    { "type": "checkbox", "id": "show_decorations", "label": "Show decorative shapes", "default": true },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "number", "id": "autoplay_speed", "label": "Autoplay speed (ms)", "default": 5000 },
    { "type": "select", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1", "options": [
      { "value": "scheme-1", "label": "Scheme 1" },
      { "value": "scheme-2", "label": "Scheme 2" },
      { "value": "scheme-3", "label": "Scheme 3" },
      { "value": "scheme-4", "label": "Scheme 4" }
    ]},
    { "type": "range", "id": "padding_top", "label": "Padding top", "min": 0, "max": 80, "step": 4, "default": 40 },
    { "type": "range", "id": "padding_bottom", "label": "Padding bottom", "min": 0, "max": 80, "step": 4, "default": 40 }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "range", "id": "rating", "label": "Rating", "min": 1, "max": 5, "step": 1, "default": 5 },
        { "type": "richtext", "id": "review_text", "label": "Review text", "default": "<p>After a week, my days felt more even. No spikes, no crashes, just steadier energy and mood.</p>" },
        { "type": "text", "id": "customer_name", "label": "Customer name", "default": "Maya" }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Kefey Testimonials Carousel",
      "category": "Testimonials",
      "blocks": [
        { "type": "testimonial" },
        { "type": "testimonial" },
        { "type": "testimonial" }
      ]
    }
  ]
}
{% endschema %}

