{{ 'kefey-product.css' | asset_url | stylesheet_tag }}
<script src="{{ 'kefey-product.js' | asset_url }}" defer></script>

{%- liquid
  assign kefey_product = product
  if kefey_product == blank and section.settings.product != blank
    assign kefey_product = section.settings.product
  endif
  if kefey_product == blank
    assign kefey_product = collections.all.products.first
  endif
-%}

<section class="kefey-product kefey-product-main" id="KefeyProductMain-{{ section.id }}">
  <div class="page-width">
    <div
      class="kefey-purchase"
      data-kefey-purchase
      data-default-pack="{{ section.settings.default_selected_pack }}"
      data-default-purchase-type="{{ section.settings.default_purchase_type }}"
      data-discount-percent="{{ section.settings.subscription_discount_percent }}"
      data-display-compare="{{ section.settings.display_compare_price }}"
      data-money-format="{{ shop.money_format | escape }}"
      style="
        --kp-highlight: {{ section.settings.highlight_bar_color }};
        --kp-subscribe-bg: {{ section.settings.subscribe_card_bg }};
        --kp-onetime-bg: {{ section.settings.onetime_card_bg }};
        --kp-cta-bg: {{ section.settings.cta_bg_color }};
        --kp-cta-color: {{ section.settings.cta_text_color }};
        --kp-h-ff: {{ section.settings.heading_font_family }};
        --kp-h-fs-d: {{ section.settings.heading_font_size_desktop }}px;
        --kp-h-fs-m: {{ section.settings.heading_font_size_mobile }}px;
        --kp-h-fw: {{ section.settings.heading_font_weight }};
        --kp-t-ff: {{ section.settings.text_font_family }};
        --kp-t-fs-d: {{ section.settings.text_font_size_desktop }}px;
        --kp-t-fs-m: {{ section.settings.text_font_size_mobile }}px;
        --kp-t-fw: {{ section.settings.text_font_weight }};
        --kp-p-ff: {{ section.settings.price_font_family }};
        --kp-p-fs-d: {{ section.settings.price_font_size_desktop }}px;
        --kp-p-fs-m: {{ section.settings.price_font_size_mobile }}px;
        --kp-p-fw: {{ section.settings.price_font_weight }};
      "
    >
      <header class="kefey-purchase__header">
        <h2 class="kefey-purchase__heading"><span>{{ section.settings.purchase_heading }}</span></h2>
        <p class="kefey-purchase__subheading">{{ section.settings.purchase_subheading }}</p>
        <p class="kefey-purchase__note">{{ section.settings.purchase_note }}</p>
      </header>

      <div class="kefey-purchase__grid">
        <div class="kefey-purchase__left">
          <div class="kefey-purchase__image-card">
            {%- if kefey_product and kefey_product.featured_image -%}
              {{
                kefey_product.featured_image
                | image_url: width: 820
                | image_tag:
                  class: 'kefey-purchase__image',
                  widths: '360, 560, 760, 820',
                  sizes: '(min-width: 990px) 440px, 90vw',
                  loading: 'lazy',
                  alt: kefey_product.title
              }}
            {%- endif -%}
          </div>
        </div>

        <div class="kefey-purchase__right">
          <div class="kefey-purchase__plans">
            <button class="kefey-purchase__plan kefey-purchase__plan--subscribe" type="button" data-plan="sub">
              <span class="kefey-purchase__badge">{{ section.settings.badge_text }}</span>
              <span class="kefey-purchase__plan-title">{{ section.settings.sub_label }}</span>
              <span class="kefey-purchase__price-row">
                <span class="kefey-purchase__price" data-sub-each>{{ section.settings.fallback_price }}</span>
                <span class="kefey-purchase__each">each</span>
                <span class="kefey-purchase__total">Total: <span data-sub-total>{{ section.settings.fallback_price }}</span></span>
                <span class="kefey-purchase__compare" data-sub-compare>{{ section.settings.display_compare_price }}</span>
              </span>
            </button>

            <button class="kefey-purchase__plan kefey-purchase__plan--one-time" type="button" data-plan="one">
              <span class="kefey-purchase__plan-title">{{ section.settings.onetime_label }}</span>
              <span class="kefey-purchase__price-row">
                <span class="kefey-purchase__price" data-one-each>{{ section.settings.fallback_price }}</span>
                <span class="kefey-purchase__each">each</span>
              </span>
            </button>

            <div class="kefey-purchase__packs" role="group" aria-label="Pack selector">
              <button class="kefey-purchase__pack" type="button" data-pack="5">{{ section.settings.pack_label_5 }}</button>
              <button class="kefey-purchase__pack" type="button" data-pack="3">{{ section.settings.pack_label_3 }}</button>
              <button class="kefey-purchase__pack" type="button" data-pack="1">{{ section.settings.pack_label_1 }}</button>
            </div>
          </div>
        </div>
      </div>
      <div class="kefey-purchase__cta-row">
        <input type="hidden" value="{{ kefey_product.selected_or_first_available_variant.id }}" data-selected-variant-id>
        <button class="kefey-purchase__cta" type="button" data-kefey-checkout>
          {{ section.settings.atc_label }}
        </button>
      </div>

      {%- if kefey_product -%}
        <script type="application/json" data-kefey-product-json>{{ kefey_product | json }}</script>
      {%- endif -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Main Product Kefey",
  "settings": [
    { "type": "product", "id": "product", "label": "Product" },
    { "type": "text", "id": "purchase_heading", "label": "Purchase heading", "default": "Never Run Out of Joy" },
    { "type": "text", "id": "purchase_subheading", "label": "Purchase subheading", "default": "More Stars | More Balance | More Smiles" },
    { "type": "text", "id": "purchase_note", "label": "Purchase red note", "default": "Subscribe & receive your Kefey® Mood Gummies monthly." },
    { "type": "text", "id": "preview_text", "label": "Preview helper text", "default": "Mood support gummies · 60 count" },
    { "type": "text", "id": "sub_label", "label": "Subscription label", "default": "Subscribe & Save" },
    { "type": "text", "id": "onetime_label", "label": "One-time label", "default": "One-time Purchase" },
    { "type": "text", "id": "sub_badge", "label": "Subscription badge text", "default": "SAVE 15% + FREE SHIPPING" },
    { "type": "text", "id": "onetime_badge", "label": "One-time badge text", "default": "STANDARD PRICING" },
    { "type": "text", "id": "badge_text", "label": "Top-right badge", "default": "10% OFF & Cancel Anytime" },
    { "type": "range", "id": "subscription_discount_percent", "label": "Subscription discount % (display)", "min": 0, "max": 50, "step": 1, "default": 10, "unit": "%" },
    { "type": "text", "id": "display_compare_price", "label": "Display compare price fallback", "default": "$75.00" },
    { "type": "text", "id": "fallback_price", "label": "Fallback price text", "default": "$39.00" },
    { "type": "text", "id": "pack_label_5", "label": "5 pack label", "default": "5 - Pack" },
    { "type": "text", "id": "pack_label_3", "label": "3 pack label", "default": "3 - Pack" },
    { "type": "text", "id": "pack_label_1", "label": "1 pack label", "default": "1 - Pack" },
    {
      "type": "select",
      "id": "default_selected_pack",
      "label": "Default selected pack",
      "default": "1",
      "options": [
        { "value": "1", "label": "1 pack" },
        { "value": "3", "label": "3 pack" },
        { "value": "5", "label": "5 pack" }
      ]
    },
    {
      "type": "select",
      "id": "default_purchase_type",
      "label": "Default purchase type",
      "default": "sub",
      "options": [
        { "value": "sub", "label": "Subscribe" },
        { "value": "one", "label": "One-time" }
      ]
    },
    { "type": "color", "id": "highlight_bar_color", "label": "Heading highlight color", "default": "#f4c820" },
    { "type": "color", "id": "subscribe_card_bg", "label": "Subscribe card background", "default": "#f4ca2a" },
    { "type": "color", "id": "onetime_card_bg", "label": "One-time card background", "default": "#49afb4" },
    { "type": "color", "id": "cta_bg_color", "label": "Checkout button background", "default": "#111111" },
    { "type": "color", "id": "cta_text_color", "label": "Checkout button text color", "default": "#ffffff" },
    { "type": "header", "content": "Heading Typography" },
    { "type": "text", "id": "heading_font_family", "label": "Heading font family", "default": "inherit" },
    { "type": "range", "id": "heading_font_size_desktop", "label": "Heading font size desktop", "min": 20, "max": 80, "step": 1, "default": 56, "unit": "px" },
    { "type": "range", "id": "heading_font_size_mobile", "label": "Heading font size mobile", "min": 16, "max": 52, "step": 1, "default": 34, "unit": "px" },
    { "type": "range", "id": "heading_font_weight", "label": "Heading font weight", "min": 300, "max": 900, "step": 100, "default": 700 },
    { "type": "header", "content": "Text Typography" },
    { "type": "text", "id": "text_font_family", "label": "Text font family", "default": "inherit" },
    { "type": "range", "id": "text_font_size_desktop", "label": "Text font size desktop", "min": 12, "max": 40, "step": 1, "default": 20, "unit": "px" },
    { "type": "range", "id": "text_font_size_mobile", "label": "Text font size mobile", "min": 10, "max": 32, "step": 1, "default": 16, "unit": "px" },
    { "type": "range", "id": "text_font_weight", "label": "Text font weight", "min": 300, "max": 900, "step": 100, "default": 500 },
    { "type": "header", "content": "Price Typography" },
    { "type": "text", "id": "price_font_family", "label": "Price font family", "default": "inherit" },
    { "type": "range", "id": "price_font_size_desktop", "label": "Price font size desktop", "min": 20, "max": 96, "step": 1, "default": 72, "unit": "px" },
    { "type": "range", "id": "price_font_size_mobile", "label": "Price font size mobile", "min": 18, "max": 72, "step": 1, "default": 48, "unit": "px" },
    { "type": "range", "id": "price_font_weight", "label": "Price font weight", "min": 300, "max": 900, "step": 100, "default": 700 },
    { "type": "text", "id": "atc_label", "label": "Add to cart label", "default": "ADD TO CART" },
    { "type": "text", "id": "trust_text", "label": "Trust microcopy", "default": "Free U.S. shipping over $50 · 30-day happiness guarantee" }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Main Product Kefey"
    }
  ]
}
{% endschema %}
