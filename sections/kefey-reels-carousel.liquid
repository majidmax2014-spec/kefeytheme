{{ 'kefey-reels-carousel.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign krc_h_ff = 'inherit'
  if section.settings.heading_font_family == 'heading'
    assign krc_h_ff = 'var(--font-heading-family)'
  elsif section.settings.heading_font_family == 'body'
    assign krc_h_ff = 'var(--font-body-family)'
  endif

  assign krc_t_ff = 'inherit'
  if section.settings.text_font_family == 'heading'
    assign krc_t_ff = 'var(--font-heading-family)'
  elsif section.settings.text_font_family == 'body'
    assign krc_t_ff = 'var(--font-body-family)'
  endif
-%}

<section
  id="KefeyReels-{{ section.id }}"
  class="kefey-reels-carousel"
  data-autoplay="{{ section.settings.autoplay }}"
  data-speed="{{ section.settings.autoplay_speed | default: 4000 }}"
  style="
    --krc-pt: {{ section.settings.padding_top | default: 40 }}px;
    --krc-pb: {{ section.settings.padding_bottom | default: 32 }}px;
    --krc-heading-size: {{ section.settings.heading_size | default: 48 }}px;
    --krc-highlight: {{ section.settings.highlight_color | default: '#F5C524' }};
    --krc-gap: {{ section.settings.card_gap | default: 20 }}px;
    --krc-radius: {{ section.settings.card_radius | default: 14 }}px;
    --krc-bg: {{ section.settings.background_color | default: '#ffffff' }};
    --krc-caption-fs: {{ section.settings.caption_font_size | default: 14 }}px;
    --krc-h-ff: {{ krc_h_ff }};
    --krc-h-fw: {{ section.settings.heading_font_weight }};
    --krc-h-fs: {{ section.settings.heading_size | default: 48 }}px;
    --krc-t-ff: {{ krc_t_ff }};
    --krc-t-fw: {{ section.settings.text_font_weight }};
    --krc-t-fs: {{ section.settings.caption_font_size | default: 14 }}px;
  "
>
  <div class="kefey-reels-carousel__inner">
    {% if section.settings.heading != blank %}
      <div class="kefey-reels-carousel__header">
        <h2 class="kefey-reels-carousel__title">
          <span class="kefey-reels-carousel__title-text">{{ section.settings.heading }}</span>
          <span class="kefey-reels-carousel__highlight" style="background-color: {{ section.settings.highlight_color }};"></span>
        </h2>
      </div>
    {% endif %}

    <div class="kefey-reels-carousel__carousel-wrapper">
      <div class="kefey-reels-carousel__viewport" aria-roledescription="carousel">
        <ul class="kefey-reels-carousel__track" role="list" aria-label="Kefey reels carousel">
          {% for block in section.blocks %}
            {% assign poster = block.settings.thumbnail %}
            {% assign source_type = block.settings.source_type | default: 'none' %}
            {% assign youtube_id = block.settings.youtube_url.id | default: '' %}
            {% assign youtube_url = block.settings.youtube_url.url | default: '' %}
            {% if youtube_url == blank and block.settings.youtube_url != blank %}
              {% assign youtube_url = block.settings.youtube_url %}
            {% endif %}
            <li class="kefey-reels-carousel__slide" {{ block.shopify_attributes }}>
              <div
                class="kefey-reels-carousel__card"
                data-source-type="{{ source_type }}"
                {% if youtube_id != blank %}data-youtube-id="{{ youtube_id | escape }}"{% endif %}
                {% if youtube_url != blank %}data-youtube-url="{{ youtube_url | escape }}"{% endif %}
              >
                <div class="kefey-reels-carousel__media">
                  <div class="kefey-reels-carousel__poster">
                    {% if poster != blank %}
                      <img
                        srcset="
                          {{ poster | image_url: width: 360 }} 360w,
                          {{ poster | image_url: width: 540 }} 540w,
                          {{ poster | image_url: width: 720 }} 720w
                        "
                        sizes="(max-width: 749px) 44vw, (max-width: 1023px) 30vw, 22vw"
                        src="{{ poster | image_url: width: 540 }}"
                        width="{{ poster.width }}"
                        height="{{ poster.height }}"
                        alt="{{ block.settings.title | default: poster.alt | escape }}"
                        loading="lazy"
                      >
                    {% else %}
                      {{ 'image' | placeholder_svg_tag: 'kefey-reels-carousel__placeholder' }}
                    {% endif %}
                  </div>

                  {% if source_type == 'shopify' and block.settings.shopify_video != blank %}
                    <template class="kefey-reels-carousel__shopify-video-template">
                      {{ block.settings.shopify_video | video_tag: controls: true, playsinline: true, preload: 'metadata' }}
                    </template>
                  {% endif %}

                  {% if source_type == 'embed' and block.settings.embed_html != blank %}
                    <div class="kefey-reels-carousel__embed-source" hidden>
                      {{ block.settings.embed_html }}
                    </div>
                  {% endif %}

                  <div class="kefey-reels-carousel__player" hidden></div>
                  <button class="kefey-reels-carousel__close" type="button" hidden aria-label="Close video">&times;</button>
                </div>

                {% if section.settings.show_play_icon and source_type != 'none' %}
                  <button class="kefey-reels-carousel__play" type="button" aria-label="Play video"></button>
                {% endif %}
                {% if block.settings.title != blank %}
                  <span class="kefey-reels-carousel__caption">{{ block.settings.title }}</span>
                {% endif %}
                {% if source_type == 'none' and block.settings.link != blank %}
                  <a class="kefey-reels-carousel__link-overlay" href="{{ block.settings.link }}" aria-label="{{ block.settings.title | default: 'Open reel' | escape }}"></a>
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>

      {% if section.settings.show_arrows %}
        <button class="kefey-reels-carousel__arrow kefey-reels-carousel__arrow--prev" type="button" aria-label="Previous reels">
          <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
        </button>
        <button class="kefey-reels-carousel__arrow kefey-reels-carousel__arrow--next" type="button" aria-label="Next reels">
          <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
        </button>
      {% endif %}
    </div>

    <div class="kefey-reels-carousel__dots" role="tablist" aria-label="Reels pagination"></div>
  </div>
</section>

{{ 'kefey-reels-carousel.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Kefey Reels",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Kefey in Real Life" },
    { "type": "range", "id": "heading_size", "label": "Heading size (px)", "min": 24, "max": 72, "step": 2, "default": 48 },
    {
      "type": "select",
      "id": "heading_font_family",
      "label": "Heading font family",
      "default": "inherit",
      "options": [
        { "value": "inherit", "label": "Theme default" },
        { "value": "heading", "label": "Heading font" },
        { "value": "body", "label": "Body font" }
      ]
    },
    {
      "type": "select",
      "id": "heading_font_weight",
      "label": "Heading font weight",
      "default": "inherit",
      "options": [
        { "value": "inherit", "label": "inherit" },
        { "value": "400", "label": "400" },
        { "value": "500", "label": "500" },
        { "value": "600", "label": "600" },
        { "value": "700", "label": "700" },
        { "value": "800", "label": "800" }
      ]
    },
    { "type": "color", "id": "highlight_color", "label": "Highlight color", "default": "#F5C524" },
    { "type": "color", "id": "background_color", "label": "Background color", "default": "#ffffff" },
    { "type": "range", "id": "caption_font_size", "label": "Caption font size (px)", "min": 10, "max": 28, "step": 1, "default": 14 },
    {
      "type": "select",
      "id": "text_font_family",
      "label": "Caption font family",
      "default": "inherit",
      "options": [
        { "value": "inherit", "label": "Theme default" },
        { "value": "heading", "label": "Heading font" },
        { "value": "body", "label": "Body font" }
      ]
    },
    {
      "type": "select",
      "id": "text_font_weight",
      "label": "Caption font weight",
      "default": "inherit",
      "options": [
        { "value": "inherit", "label": "inherit" },
        { "value": "400", "label": "400" },
        { "value": "500", "label": "500" },
        { "value": "600", "label": "600" },
        { "value": "700", "label": "700" },
        { "value": "800", "label": "800" }
      ]
    },
    { "type": "range", "id": "padding_top", "label": "Padding top", "min": 0, "max": 200, "step": 4, "default": 40 },
    { "type": "range", "id": "padding_bottom", "label": "Padding bottom", "min": 0, "max": 200, "step": 4, "default": 32 },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "number", "id": "autoplay_speed", "label": "Autoplay speed (ms)", "default": 4000 },
    { "type": "checkbox", "id": "show_arrows", "label": "Show arrows", "default": false },
    { "type": "checkbox", "id": "show_play_icon", "label": "Show play icon overlay", "default": true },
    { "type": "range", "id": "card_radius", "label": "Card radius (px)", "min": 8, "max": 40, "step": 1, "default": 14 },
    { "type": "range", "id": "card_gap", "label": "Card gap (px)", "min": 8, "max": 40, "step": 2, "default": 20 }
  ],
  "blocks": [
    {
      "type": "reel",
      "name": "Reel item",
      "settings": [
        { "type": "image_picker", "id": "thumbnail", "label": "Thumbnail image" },
        { "type": "text", "id": "title", "label": "Title", "default": "Reel" },
        { "type": "url", "id": "link", "label": "Link URL (image-only mode)" },
        {
          "type": "select",
          "id": "source_type",
          "label": "Video source",
          "default": "none",
          "options": [
            { "value": "none", "label": "None (image only)" },
            { "value": "shopify", "label": "Uploaded video (Shopify)" },
            { "value": "youtube", "label": "YouTube" },
            { "value": "embed", "label": "Embed code (Instagram/TikTok/etc)" }
          ]
        },
        { "type": "video", "id": "shopify_video", "label": "Upload video (Shopify)" },
        { "type": "video_url", "id": "youtube_url", "label": "YouTube link", "accept": ["youtube"] },
        { "type": "html", "id": "embed_html", "label": "Embed code (Instagram/TikTok/etc)" }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Kefey Reels",
      "category": "Media",
      "blocks": [
        { "type": "reel", "settings": { "title": "This/That" } },
        { "type": "reel", "settings": { "title": "Best Sellers" } },
        { "type": "reel", "settings": { "title": "OLLY Body" } },
        { "type": "reel", "settings": { "title": "Women's 40+" } },
        { "type": "reel", "settings": { "title": "Now" } }
      ]
    }
  ]
}
{% endschema %}

